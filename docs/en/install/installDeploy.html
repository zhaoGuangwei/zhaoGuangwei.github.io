<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JDChain安装部署指南 | JDChain Documentation</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Documentation for the JDChain.">
    <link rel="preload" href="/assets/css/0.styles.c5881045.css" as="style"><link rel="preload" href="/assets/js/app.7b6fef2b.js" as="script"><link rel="preload" href="/assets/js/2.90fa5f0e.js" as="script"><link rel="preload" href="/assets/js/5.a5303e39.js" as="script"><link rel="prefetch" href="/assets/js/10.fa8d6b37.js"><link rel="prefetch" href="/assets/js/11.7ff1b89b.js"><link rel="prefetch" href="/assets/js/12.ac11970c.js"><link rel="prefetch" href="/assets/js/13.74ca3465.js"><link rel="prefetch" href="/assets/js/14.7be03bac.js"><link rel="prefetch" href="/assets/js/15.3bb16634.js"><link rel="prefetch" href="/assets/js/16.f02fb7b0.js"><link rel="prefetch" href="/assets/js/17.af195912.js"><link rel="prefetch" href="/assets/js/18.e7845c25.js"><link rel="prefetch" href="/assets/js/19.daa05258.js"><link rel="prefetch" href="/assets/js/20.38399006.js"><link rel="prefetch" href="/assets/js/3.fcf137af.js"><link rel="prefetch" href="/assets/js/4.9b04dcf2.js"><link rel="prefetch" href="/assets/js/6.787304d3.js"><link rel="prefetch" href="/assets/js/7.0a665dcf.js"><link rel="prefetch" href="/assets/js/8.45a51d34.js"><link rel="prefetch" href="/assets/js/9.7e1b79d5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c5881045.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">JDChain Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://ledger.jd.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Back to JDChain.
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://storage.jd.com/jd.block.chain/%E4%BA%AC%E4%B8%9C%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%E7%99%BD%E7%9A%AE%E4%B9%A62019.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  White Paper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/install/installDeploy.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/install/installDeploy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://ledger.jd.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Back to JDChain.
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://storage.jd.com/jd.block.chain/%E4%BA%AC%E4%B8%9C%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5%E7%99%BD%E7%9A%AE%E4%B9%A62019.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  White Paper
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/install/installDeploy.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/install/installDeploy.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/api/api.html" class="sidebar-link">API使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/design/architecturedesign.html" class="sidebar-link">架构设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>安装</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/install/installDeploy.html" aria-current="page" class="active sidebar-link">安装部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_1-部署环境" class="sidebar-link">1. 部署环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_1-1-系统部署结构" class="sidebar-link">1.1 系统部署结构</a></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_1-2-服务器配置" class="sidebar-link">1.2 服务器配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-系统安装与配置" class="sidebar-link">2. 系统安装与配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-1-安装包结构" class="sidebar-link">2.1 安装包结构</a></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-2-注册用户" class="sidebar-link">2.2 注册用户</a></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-3-账本初始化" class="sidebar-link">2.3 账本初始化</a></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-4-peer节点安装" class="sidebar-link">2.4 Peer节点安装</a></li><li class="sidebar-sub-header"><a href="/en/install/installDeploy.html#_2-5-gateway节点安装" class="sidebar-link">2.5 Gateway节点安装</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>代码</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/code/codeexample.html" class="sidebar-link">代码示例</a></li><li><a href="/en/code/contract.html" class="sidebar-link">智能合约</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>KVDB</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/kvdb/kvdb.html" class="sidebar-link">KVDB使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>检索</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/argus/argus.html" class="sidebar-link">高级检索</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jdchain安装部署指南"><a href="#jdchain安装部署指南" class="header-anchor">#</a> JDChain安装部署指南</h1> <p>本部署指南基于JDChain1.3.0.RELEASE版本来构建。</p> <h2 id="_1-部署环境"><a href="#_1-部署环境" class="header-anchor">#</a> 1. 部署环境</h2> <h3 id="_1-1-系统部署结构"><a href="#_1-1-系统部署结构" class="header-anchor">#</a> 1.1 系统部署结构</h3> <p><img src="/assets/img/structure.f8a466df.png" alt="部署结构"></p> <p>JDChain有三类节点：Peer、网关和客户端。peer节点是区块链主节点，参与共识、账本操作等；网关节点（GateWay）与Peer节点通信，负责区块链浏览器及消息传递；客户端与网关通信，可以进行写入或查询账本等操作。</p> <p>JDChain默认采用Rocksdb作为存储数据库，每个Peer节点与一个（或多个）Rocksdb实例连接，Rocksdb实例的数量与账本相关，不同Peer节点对应不同的Rocksdb实例。</p> <p>JDChain也支持Redis作为其存储数据库，Redis数据库不必和Peer节点安装在同一服务器，只需要配置正确即可（后面配置会说到）。</p> <p>JDChain默认共识机制采用的是BFTSmart，该共识算法要求最低四个共识节点，BFTSmart 对作恶节点的支持为：N = 3f+1，即在N个节点共识中可允许f个作恶节点，当节点数增加时可根据该公式进行配置。</p> <p><em>本安装部署指南以四个节点为例进行说明。</em></p> <hr> <h3 id="_1-2-服务器配置"><a href="#_1-2-服务器配置" class="header-anchor">#</a> 1.2 服务器配置</h3> <h4 id="_1-2-1-硬件配置"><a href="#_1-2-1-硬件配置" class="header-anchor">#</a> 1.2.1 硬件配置</h4> <p>为了更好的运行，JDChain推荐使用 <strong>Linux</strong> 操作系统，Peer节点自身运行对内存要求较低（单节点建议Xms&gt;=4g），但对于Rocksdb存储而言，其对运行环境有较高要求，以下为单Peer节点可正常运行  <strong>亿级交易</strong> 的参考指标：</p> <ul><li>内核2.7.x及以上；</li> <li>CPU主频 ≥ 2.0GHz；</li> <li>内存 ≥ 64G；</li> <li>可用硬盘容量 &gt;= 200G</li></ul> <h4 id="_1-2-2-软件配置"><a href="#_1-2-2-软件配置" class="header-anchor">#</a> 1.2.2 软件配置</h4> <p>JDChain使用Java开发，其软件需求如下：</p> <ul><li>JDK：Version ≥ 1.8。</li></ul> <blockquote><p>注意：若数据库使用的Redis，则需要对应数据库服务器安装Redis，Redis版本要求&gt;=3.x。</p></blockquote> <hr> <h2 id="_2-系统安装与配置"><a href="#_2-系统安装与配置" class="header-anchor">#</a> 2. 系统安装与配置</h2> <h3 id="_2-1-安装包结构"><a href="#_2-1-安装包结构" class="header-anchor">#</a> 2.1 安装包结构</h3> <p>JDChain默认发布的安装包有两个，一个是Peer节点打包程序，一个是Gateway节点打包程序，两者默认都是用tar.gz（或zip）打包的。</p> <h4 id="_2-1-1-peer节点安装包"><a href="#_2-1-1-peer节点安装包" class="header-anchor">#</a> 2.1.1 Peer节点安装包</h4> <p>Peer节点打包程序为：jdchain-peer-$version.tar.gz或jdchain-peer-$version.zip，若是tar.gz压缩文件可通过tar命令解压（如下）：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">tar</span> -xzvf jdchain-peer-<span class="token variable">$version</span>.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若是zip文件可通过unzip命令解压（如下）：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">unzip</span> jdchain-peer-<span class="token variable">$version</span>.zip
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意：$version为JDChain发布的版本号</p></blockquote> <p>Peer打包程序解压完后的安装包结构如下：</p> <ul><li>bin
<ul><li>keygen.sh</li> <li>ledger-init.sh</li> <li>peer-startup.sh</li> <li>peer-shutdown.sh</li> <li>manager-startup.sh</li> <li>manager-shutdown.sh</li></ul></li> <li>config
<ul><li>init
<ul><li>ledger.init</li> <li>local.conf</li> <li>bftsmart.config（默认）</li></ul></li> <li>keys
<ul><li>%.priv</li> <li>%.pub</li> <li>%.pwd</li></ul></li> <li>ledger-binding.conf</li></ul></li> <li>docs</li> <li>libs</li> <li>system</li></ul> <p>其中目录说明如下：</p> <ul><li><strong>bin</strong> ：相关命令操作目录；</li> <li><strong>config</strong> ：对应命令的配置目录，keys路径解压时不存在，会在执行keygen.sh脚本时自动创建；ledger-binding.conf文件解压时不存在，会在成功执行ledger-init.sh脚本后生成；</li> <li><strong>docs</strong> ：相关文档保存目录；</li> <li><strong>libs</strong> ：项目运行依赖第三方及非system依赖包保存路径；</li> <li><strong>system</strong> ：项目运行系统包保存路径；</li></ul> <blockquote><p>1）注意： <em>bin</em> 目录下所有的文件都需要可执行权限，在Linux环境下可简单参考如下命令：</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd bin
chmod 777 *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>2）注意：system文件夹包括运行时系统主要加载的jar文件，为系统安全运行定制，开发者无须关心此项。</p></blockquote> <h4 id="_2-1-2-gateway节点安装包"><a href="#_2-1-2-gateway节点安装包" class="header-anchor">#</a> 2.1.2 Gateway节点安装包</h4> <p>Gateway节点打包程序为：jdchain-gateway-$version.tar.gz或jdchain-gateway-$version.zip，其解压完后的安装包结构如下：</p> <ul><li>bin
<ul><li>startup.sh</li> <li>shutdown.sh</li></ul></li> <li>config
<ul><li>gateway.conf</li></ul></li> <li>lib</li></ul> <p>其中目录说明如下：</p> <ul><li><strong>bin</strong> ：相关命令操作目录；</li> <li><strong>config</strong> ：对应命令的配置目录；</li> <li><strong>lib</strong> ：gateway运行时所需jar包路径；</li></ul> <h3 id="_2-2-注册用户"><a href="#_2-2-注册用户" class="header-anchor">#</a> 2.2 注册用户</h3> <p>JDChain以一个 <em>密钥对</em> 标识一个用户，任何区块链操作都必须有用户的签名信息，因此首先需要创建一个用户。<br>
JDChain提供了创建用户的工具，可直接通过命令行生成一个新用户。切换到bin路径，执行命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./keygen.sh -n jd-com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中jd-com是生成的密钥对文件前缀，需自定义。<br>
执行命令过程中需要输入密钥对中 <em>私钥</em> 加密的密码，并选择是否将该密码编码保存（推荐选择保存，该密码编码会保存至%.pwd文件中）。</p> <blockquote><p>注意：请妥善保存该密码，切勿丢失！</p></blockquote> <p>执行命令后，该 <em>密钥对</em> 文件会生成到 <em>config/keys</em> 路径，如下所示：</p> <p><img src="/assets/img/keys.f2d21723.jpeg" alt="keys"></p> <p>其中，jd-com.priv是签名私钥的密文形式内容（以口令哈希作为对称密钥，对签名私钥进行对称加密后的密文数据），jd-com.pub为签名公钥内容，jd-com.pwd是用于加密签名私钥的口令哈希值。</p> <blockquote><p>注意：%.pwd记录的编码在后续Gateway配置时会用到！</p></blockquote> <p><strong>请将所有Peer节点都按照上述流程注册一个独立的用户，在实际生产环境中该过程可能由不同的参与方完成。</strong></p> <h3 id="_2-3-账本初始化"><a href="#_2-3-账本初始化" class="header-anchor">#</a> 2.3 账本初始化</h3> <p>账本初始化是所有参与Peer节点进行共识，并生成初始化账本至数据库的过程。该过程需要所有节点共同参与，<strong>同时启动</strong>。</p> <h4 id="_2-3-1-初始化配置"><a href="#_2-3-1-初始化配置" class="header-anchor">#</a> 2.3.1 初始化配置</h4> <p><em>config/init</em> 目录下有三个配置文件需要修改：<strong>local.conf</strong> 、 <strong>ledger.init</strong> 和 <strong>bftsmart.config</strong> 。</p> <ul><li>local.conf描述账本初始化的本地（即当前节点）配置；</li> <li>ledger.init描述账本初始化过程中涉及到的其他参与Peer节点配置信息;</li> <li>bftsmart.config为BFTSmart进行共识的相关配置。</li></ul> <h5 id="_2-3-1-1-local-conf配置"><a href="#_2-3-1-1-local-conf配置" class="header-anchor">#</a> 2.3.1.1 local.conf配置</h5> <div class="language-config line-numbers-mode"><pre class="language-text"><code>#当前参与方的 id
local.parti.id=0

#当前参与方的公钥
local.parti.pubkey=endPsK36koyFr1D245Sa9j83vt6pZUdFBJoJRB3xAsWM6cwhRbna

#当前参与方的私钥（密文编码）
local.parti.privkey=177gjsj5PHeCpbAtJE7qnbmhuZMHAEKuMsd45zHkv8F8AWBvTBbff8yRKdCyT3kwrmAjSnY

#当前参与方的私钥解密密钥(原始口令的一次哈希，Base58格式)，如果不设置，则启动过程中需要从控制台输入
local.parti.pwd=DYu3G8aGTMBW1WrTw76zxQJQU4DHLw9MLyy7peG4LKkY

#账本初始化完成后生成的&quot;账本绑定配置文件&quot;的输出目录
ledger.binding.out=../config

#账本数据库的连接字符，下为rocksdb样例
#rocksdb数据库连接格式：rocksdb://{path}，例如：rocksdb:///export/App08/peer/rocks.db/rocksdb0.db
#redis数据库连接格式：redis://{ip}:{prot}/{db}，例如：redis://127.0.0.1:6379/0
#kvdb数据库连接格式：kvdb://{ip}:{prot}/{db}，例如：kvdb://127.0.0.1:7078/test
ledger.db.uri=rocksdb:///export/app/peer/rocks.db/rocksdb0.db

#账本数据库的连接口令
ledger.db.pwd=
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>其中local.parti.id从 <strong>0</strong> 开始编号，且不同Peer节点不能相同；local.parti.privkey为当前节点私钥，即 <em>config/keys/%.priv</em> 文件中的内容；其他参数根据实际环境进行配置。</p> <h5 id="_2-3-1-2-ledger-init配置"><a href="#_2-3-1-2-ledger-init配置" class="header-anchor">#</a> 2.3.1.2 ledger.init配置</h5> <div class="language-config line-numbers-mode"><pre class="language-text"><code>#账本的种子；一段16进制字符，最长可以包含64个字符；可以用字符“-”分隔，以便更容易读取；
ledger.seed=932dfe23-fe23232f-283f32fa-dd32aa76-8322ca2f-56236cda-7136b322-cb323ffe

#账本的描述名称；此属性不参与共识，仅仅在当前参与方的本地节点用于描述用途；
ledger.name=

#声明的账本创建时间；格式为 “yyyy-MM-dd HH:mm:ss.SSSZ”，表示”年-月-日 时:分:秒:毫秒时区“；例如：“2019-08-01 14:26:58.069+0800”，其中，+0800 表示时区是东8区
created-time=2019-08-01 14:26:58.069+0800


#-----------------------------------------------
# 初始的角色名称列表；可选项；
# 角色名称不区分大小写，最长不超过20个字符；多个角色名称之间用半角的逗点“,”分隔；
# 系统会预置一个默认角色“DEFAULT”，所有未指定角色的用户都以赋予该角色的权限；若初始化时未配置默认角色的权限，则为默认角色分配所有权限；
#
# 注：如果声明了角色，但未声明角色对应的权限清单，这会忽略该角色的初始化；
#
#security.roles=DEFAULT, ADMIN, MANAGER, GUEST

# 赋予角色的账本权限清单；可选项；
# 可选的权限如下；
# AUTHORIZE_ROLES, SET_CONSENSUS, SET_CRYPTO, REGISTER_PARTICIPANT,
# REGISTER_USER, REGISTER_DATA_ACCOUNT, REGISTER_CONTRACT, UPGRADE_CONTRACT, 
# SET_USER_ATTRIBUTES, WRITE_DATA_ACCOUNT, 
# APPROVE_TX, CONSENSUS_TX
# 多项权限之间用逗点“,”分隔；
# 
#security.role.DEFAULT.ledger-privileges=REGISTER_USER, REGISTER_DATA_ACCOUNT

# 赋予角色的交易权限清单；可选项；
# 可选的权限如下；
# DIRECT_OPERATION, CONTRACT_OPERATION
# 多项权限之间用逗点“,”分隔；
#
#security.role.DEFAULT.tx-privileges=DIRECT_OPERATION, CONTRACT_OPERATION

# 其它角色的配置示例；
# 系统管理员角色：只能操作全局性的参数配置和用户注册，只能执行直接操作指令；
#security.role.ADMIN.ledger-privileges=CONFIGURE_ROLES, AUTHORIZE_USER_ROLES, SET_CONSENSUS, SET_CRYPTO, REGISTER_PARTICIPANT, REGISTER_USER
#security.role.ADMIN.tx-privileges=DIRECT_OPERATION

# 业务主管角色：只能够执行账本数据相关的操作，包括注册用户、注册数据账户、注册合约、升级合约、写入数据等；能够执行直接操作指令和调用合约；
#security.role.MANAGER.ledger-privileges=CONFIGURE_ROLES, AUTHORIZE_USER_ROLES, REGISTER_USER, REGISTER_DATA_ACCOUNT, REGISTER_CONTRACT, UPGRADE_CONTRACT, SET_USER_ATTRIBUTES, WRITE_DATA_ACCOUNT, 
#security.role.MANAGER.tx-privileges=DIRECT_OPERATION, CONTRACT_OPERATION

# 访客角色：不具备任何的账本权限，只有数据读取的操作；也只能够通过调用合约来读取数据；
#security.role.GUEST.ledger-privileges=
#security.role.GUEST.tx-privileges=CONTRACT_OPERATION


#-----------------------------------------------
#共识服务提供者；必须；
consensus.service-provider=com.jd.blockchain.consensus.bftsmart.BftsmartConsensusProvider

#共识服务的参数配置；推荐使用绝对路径；必须；
consensus.conf=bftsmart.config

#密码服务提供者列表，以英文逗点“,”分隔；必须；
crypto.service-providers=com.jd.blockchain.crypto.service.classic.ClassicCryptoService, \
com.jd.blockchain.crypto.service.sm.SMCryptoService

#从存储中加载账本数据时，是否校验哈希；可选；
crypto.verify-hash=true

#哈希算法；
crypto.hash-algorithm=SHA256


#参与方的个数，后续以 cons_parti.id 分别标识每一个参与方的配置；
cons_parti.count=4

#---------------------
#第0个参与方的名称；
cons_parti.0.name=
#第0个参与方的公钥文件路径；
cons_parti.0.pubkey-path=
#第0个参与方的公钥内容（由keygen工具生成）；此参数优先于 pubkey-path 参数；
cons_parti.0.pubkey=

#第0个参与方的角色清单；可选项；
#cons_parti.0.roles=ADMIN, MANAGER
#第0个参与方的角色权限策略，可选值有：UNION（并集），INTERSECT（交集）；可选项；
#cons_parti.0.roles-policy=UNION

#第0个参与方的账本初始服务的主机；
cons_parti.0.initializer.host=127.0.0.1
#第0个参与方的账本初始服务的端口；
cons_parti.0.initializer.port=8800
#第0个参与方的账本初始服务是否开启安全连接；
cons_parti.0.initializer.secure=false

#---------------------
#第1个参与方的名称；
cons_parti.1.name=
#第1个参与方的公钥文件路径；
cons_parti.1.pubkey-path=
#第1个参与方的公钥内容（由keygen工具生成）；此参数优先于 pubkey-path 参数；
cons_parti.1.pubkey=

#第1个参与方的角色清单；可选项；
#cons_parti.1.roles=MANAGER
#第1个参与方的角色权限策略，可选值有：UNION（并集），INTERSECT（交集）；可选项；
#cons_parti.1.roles-policy=UNION

#第1个参与方的账本初始服务的主机；
cons_parti.1.initializer.host=127.0.0.1
#第1个参与方的账本初始服务的端口；
cons_parti.1.initializer.port=8810
#第1个参与方的账本初始服务是否开启安全连接；
cons_parti.1.initializer.secure=false

#---------------------
#第2个参与方的名称；
cons_parti.2.name=
#第2个参与方的公钥文件路径；
cons_parti.2.pubkey-path=
#第2个参与方的公钥内容（由keygen工具生成）；此参数优先于 pubkey-path 参数；
cons_parti.2.pubkey=

#第2个参与方的角色清单；可选项；
#cons_parti.2.roles=MANAGER
#第2个参与方的角色权限策略，可选值有：UNION（并集），INTERSECT（交集）；可选项；
#cons_parti.2.roles-policy=UNION

#第2个参与方的账本初始服务的主机；
cons_parti.2.initializer.host=127.0.0.1
#第2个参与方的账本初始服务的端口；
cons_parti.2.initializer.port=8820
#第2个参与方的账本初始服务是否开启安全连接；
cons_parti.2.initializer.secure=false

#---------------------
#第3个参与方的名称；
cons_parti.3.name=
#第3个参与方的公钥文件路径；
cons_parti.3.pubkey-path=
#第3个参与方的公钥内容（由keygen工具生成）；此参数优先于 pubkey-path 参数；
cons_parti.3.pubkey=

#第3个参与方的角色清单；可选项；
#cons_parti.3.roles=GUEST
#第3个参与方的角色权限策略，可选值有：UNION（并集），INTERSECT（交集）；可选项；
#cons_parti.3.roles-policy=INTERSECT

#第3个参与方的账本初始服务的主机；
cons_parti.3.initializer.host=127.0.0.1
#第3个参与方的账本初始服务的端口；
cons_parti.3.initializer.port=8830
#第3个参与方的账本初始服务是否开启安全连接；
cons_parti.3.initializer.secure=false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br></div></div><p>账本初始化过程中，需要其他Peer节点的公钥信息进行验证及保存，因此每个节点都需要获取其他Peer节点的公钥信息至本地。配置中cons_parti.N.*****中的N需按照实际每个参与方定义的序号配置（该配置为local.conf中的local.parti.id）。其他参数根据实际环境进行配置。</p> <blockquote><p>注意：上述config中只显示了两个参与方（Peer节点）的配置信息，其他参与方（默认是4个节点）的配置方式一致！</p></blockquote> <h5 id="_2-3-1-3-bftsmart-config配置"><a href="#_2-3-1-3-bftsmart-config配置" class="header-anchor">#</a> 2.3.1.3 bftsmart.config配置</h5> <div class="language-config line-numbers-mode"><pre class="language-text"><code>system.server.0.network.host=127.0.0.1
system.server.0.network.port=16000

system.server.1.network.host=127.0.0.1
system.server.1.network.port=16010

system.servers.num = 4

system.servers.f = 1

system.initial.view = 0,1,2,3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>注意：上述只是将bftsmart.config文件中主要需要修改的参数显示，以方便进行相关说明，其他参数的修改可参考具体文件中的具体说明</p></blockquote> <p>参数具体说明如下：</p> <ul><li>system.server.$n.network.host：第n个节点的域名；</li> <li>system.server.$n.network.port：第n个节点的共识端口；</li> <li>system.servers.num：共识节点总数；</li> <li>system.servers.f：共识节点最大支持的作恶节点数；</li> <li>system.initial.view：为每个共识节点分配的viewID，每个viewID之间使用英文逗号分隔，viewID不允许重复，且viewID总数需要和system.servers.num一致。</li></ul> <h4 id="_2-3-2-初始化部署"><a href="#_2-3-2-初始化部署" class="header-anchor">#</a> 2.3.2 初始化部署</h4> <p>按照 <em>2.3.1章节</em> 配置完成后，只需要启动ledger-init.sh即可，可参考如下命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> bin
./ledger-init.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行命令之后，控制台会显示如下类似信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>------ Web controller of Ledger Initializer[127.0.0.1:30010] was started. ------

Init settings and sign permision...
[PERMISSION_READY] Ledger init permission has already prepared! Any key to continue...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后需要依次启动剩余节点的初始化脚本（<em>ledger-init.sh</em>），根据提示按任意键继续。<br>
如果其它节点没有准备好，控制台会展示“Connection refused”异常信息,不断进行重试操作。目前默认设置为重试180次操作，每次间隔时间10秒。<br>
执行成功后会在 <em>config</em> 目录下生成ledger-binding.conf文件，该文件即账本初始化生成的文件，Peer节点启动时需要依赖该文件。</p> <blockquote><p>1）注意：因为JDChain支持多账本形式，若config/ledger-binding.conf文件在初始化之前就存在的话，初始化操作后不会覆盖其中的内容，会以追加的方式写入。若第一次创建账本，建议先将该文件删除再进行初始化！</p></blockquote> <blockquote><p>2）注意：Peer节点会定时检测ledger-binding.conf，有新账本加入时会自动进行更新，不需要重启Peer节点！目前默认时间每隔5秒钟自动更新；</p></blockquote> <p>账本初始化成功后，每个Peer节点对应的Rocksdb都会写入该账本相关的数据。</p> <h3 id="_2-4-peer节点安装"><a href="#_2-4-peer节点安装" class="header-anchor">#</a> 2.4 Peer节点安装</h3> <p>Peer节点启动依赖于 <em>config</em> 目录下ledger-binding.conf的配置，该文件由 <em>2.3章节</em> 操作生成，无须做任何修改。</p> <p>由于Peer节点启动后会自动与其他参与节点进行通信，因此需要同时启动4个Peer节点，只需要执行startup.sh即可，参考命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> bin
./peer-startup.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>1）注意：startup.sh命令中可修改启动端口，默认为：-p 7080；</p></blockquote> <blockquote><p>2）注意：Peer节点会与账本中涉及到的参与方进行通信，当通信不成功（例如有节点尚未启动）时，会自动进行重试，因此多个Peer节点启动可不必完全同时进行。目前默认设置为重试601次操作，每次间隔时间3秒。</p></blockquote> <h3 id="_2-5-gateway节点安装"><a href="#_2-5-gateway节点安装" class="header-anchor">#</a> 2.5 Gateway节点安装</h3> <p>GateWay（网关）节点可以认为是一个过滤节点，交易的提交及账本的查询都需要通过网关节点与Peer节点进行通信。
Gateway程序可独立部署，不需要依赖Peer节点，它的操作环境是 <em>2.1.2章节</em> 中解压后的环境，网关节点启动依赖于配置文件 <em>config/gateway.conf</em>。</p> <div class="language-config line-numbers-mode"><pre class="language-text"><code>#网关的HTTP服务地址；
http.host=0.0.0.0
#网关的HTTP服务端口；
http.port=8081
#网关的HTTP服务上下文路径，可选；
#http.context-path=

#共识节点的服务地址；
peer.host=127.0.0.1
#共识节点的服务端口；
peer.port=7080
#共识节点的服务是否启用安全证书；
peer.secure=false
#共识节点的服务提供解析器
peer.providers=com.jd.blockchain.consensus.bftsmart.BftsmartConsensusProvider

#数据检索服务对应URL
#若该值不配置或配置不正确，则浏览器模糊查询部分无法正常显示
data.retrieval.url=http://192.168.151.39:10001

#默认公钥的内容（Base58编码数据）；
keys.default.pubkey=
#默认私钥的路径；在 pk-path 和 pk 之间必须设置其一；
keys.default.privkey-path=
#默认私钥的内容（加密的Base58编码数据）；在 pk-path 和 pk 之间必须设置其一；
keys.default.privkey=
#默认私钥的解码密码；
keys.default.privkey-password=
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>其中keys.default.% 配置是网关的角色配置，目前暂不支持网关自定义角色，因此，网关可选择4个参与方的任何一个作为其配置（主要是密钥对）。</p> <blockquote><p>注意：keys.default.privkey-password填写内容为<em>2.2章节</em>中生成的%.pwd文件中的内容！</p></blockquote> <p>启动网关节点只需要执行：startup.sh即可，参考命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> bin
./startup.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>网关节点启动成功后，可通过访问区块链浏览器获取其账本相关信息：http://[ip]:[port]
下图为区块链浏览器首页，可供参考：</p> <p><img src="/assets/img/browser.3a741cbf.jpeg" alt="区块链浏览器"></p> <blockquote><p>注意：JDChain网关节点默认自带区块链浏览器！！！</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/design/architecturedesign.html" class="prev">
        架构设计
      </a></span> <span class="next"><a href="/en/code/codeexample.html">
        代码示例
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7b6fef2b.js" defer></script><script src="/assets/js/2.90fa5f0e.js" defer></script><script src="/assets/js/5.a5303e39.js" defer></script>
  </body>
</html>
